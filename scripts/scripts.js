!function(){function a(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}!function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src=d,g.parentNode.insertBefore(f,g)}(window,document,"script","http://www.google-analytics.com/analytics.js","ga"),localStorage.gaClientId=localStorage.gaClientId||a(),ga("create","UA-51312192-5",{storage:"none",cookieDomain:"none",clientId:localStorage.gaClientId}),ga("set","checkProtocolTask",null)}(),angular.module("moviesowlApp",["ionic","angulartics","angulartics.google.analytics","angularMoment","ion-affix"]).run(["$ionicPlatform","amMoment","$rootScope",function(a,b,c){b.changeLocale("en"),a.ready(function(){a.ready(function(){navigator.splashscreen&&setTimeout(function(){navigator.splashscreen.hide()},100)}),window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleDefault()})}]).config(["$stateProvider","$urlRouterProvider",function(a,b){console.log("Config running, adding routes!"),b.otherwise("/movies"),a.state("movies",{url:"/movies",templateUrl:"templates/movies.html",controller:"MoviesCtrl"}).state("movie",{url:"/movie/:movieId",templateUrl:"templates/movieDetails.html",controller:"MovieDetailsCtrl"}).state("showings",{url:"/showings/:movieId",templateUrl:"templates/showings.html",controller:"ShowingsCtrl"}).state("seats",{url:"/seats/:showId",templateUrl:"templates/seats.html",controller:"SeatsCtrl"})}]),angular.module("config",[]).constant("ENV",{name:"production",apiEndpoint:"http://api.yoursite.com/"}),angular.module("moviesowlApp").controller("CinemasCtrl",["$scope","$http","$ionicLoading",function(a,b,c){console.log("In cinemas controller")}]),angular.module("moviesowlApp").controller("MoviesCtrl",["$scope","$http","$rootScope","$stateParams","selectedMovieService","$state","$ionicLoading","$ionicPopup","$ionicModal","cinemasList",function(a,b,c,d,e,f,g,h,i,j){function k(){var a=[m()],b=new Date(m().getTime());b.setHours(b.getHours()+1),b.setMinutes(0);for(var c=b.getHours();24>c;c++){var d=new Date(b.getTime());d.setHours(c),a.push(d)}return a}function l(){a.startingAfter=m(),p()&&w(),q().then(r),i.fromTemplateUrl("templates/times.html",{scope:a,animation:"slide-in-up"}).then(function(b){a.timesModal=b})}function m(){return new Date}function n(){a.times=k(),a.timesModal.show()}function o(b){a.timesModal.hide(),a.startingAfter=b,w()}function p(){return!!window.localStorage.cinema}function q(){return i.fromTemplateUrl("templates/cinemas.html",{scope:a,animation:"slide-in-up"}).then(function(b){a.modal=b})}function r(){p()||a.openModal()}function s(){a.modal.show()}function t(b){window.localStorage.cinema=angular.toJson(b),a.modal.hide(),w()}function u(b){a.modal.hide()}function v(a,c){return c||(c=Math.round((new Date).getTime()/1e3)),b.get("http://api.moviesowl.com/v1/cinemas/"+a+"/movies?starting_after="+c).then(function(a){return a.data})}function w(){g.show({template:'<ion-spinner class="bubbles"></ion-spinner>',noBackdrop:!0});var b=angular.fromJson(localStorage.cinema);a.cinemaLocation=b.location;var d=Math.round(a.startingAfter.getTime()/1e3);v(b.id,d).then(function(b){c.movies=b.data,a.groups=[{name:"Great Movies",style:"balanced",movies:_.chunk(_.filter(c.movies,function(a){return a.tomato_meter>=70}),2)},{name:"Good Movies",style:"energized",movies:_.chunk(_.filter(c.movies,function(a){return a.tomato_meter>=50&&a.tomato_meter<70}),2)},{name:"Bad Movies",style:"assertive",movies:_.chunk(_.filter(c.movies,function(a){return a.tomato_meter<50&&a.tomato_meter>=0}),2)},{name:"No Rating Movies",style:"dark",movies:_.chunk(_.filter(c.movies,function(a){return a.tomato_meter<0}),2)}],a.hasNoMovies=!1,b.data.length<1&&(a.hasNoMovies=!0),g.hide(),a.$broadcast("scroll.refreshComplete")},function(){g.hide(),a.$broadcast("scroll.refreshComplete");h.alert({title:"Sorry :(",template:"Failed to load movies, /n Please try again!"})})}function x(){console.log("Reloading Movies"),a.startingAfter=m(),w()}function y(){return localStorage.viewMode||"list"}function z(){var b="";b="list"===a.mode?"grid":"list",a.mode=b,localStorage.viewMode=b}a.doRefresh=x,a.openModal=s,a.closeModal=t,a.closeModalOnly=u,a.toggleViewMode=z,a.setStartingTime=o,a.showTimesModal=n,a.cinemaLocation=d.cinemaLocation,a.cinemas=j.cinemas,a.mode=y(),l(),a.$on("$destroy",function(){a.modal.remove()}),a.selectMovie=function(a){e.setMovie(a),f.go("showings",{movieId:a.id})}}]),angular.module("moviesowlApp").controller("MovieDetailsCtrl",["$scope","$stateParams","$http","selectedMovieService","showingsDataService","$state","$q",function(a,b,c,d,e,f,g){function h(){i().then(function(b){a.movie=b})}function i(){return d.selectedMovie.id?g.when(d.selectedMovie):c.get("http://api.moviesowl.com/v1/cinemas/12/movies").then(function(a){var c=a.data.data;return d.selectedMovie=_.find(c,{id:parseInt(b.movieId)}),d.selectedMovie})}h()}]),angular.module("moviesowlApp").controller("ShowingsCtrl",["$scope","$stateParams","$http","selectedMovieService","showingsDataService","$state","$q","$ionicModal",function(a,b,c,d,e,f,g,h){function i(){j().then(function(b){a.movie=b}).then(k)}function j(){return d.selectedMovie.id?g.when(d.selectedMovie):c.get("http://api.moviesowl.com/v1/cinemas/12/movies").then(function(a){var c=a.data.data;return d.selectedMovie=_.find(c,{id:parseInt(b.movieId)}),d.selectedMovie})}function k(){a.showingsData=a.movie.showings.data,a.movie.tomato_meter<60&&(a.rottenLogo="images/rotten.png"),a.movie.tomato_meter>59&&(a.rottenLogo="images/fresh.png"),a.movie.tomato_meter>74&&(a.rottenLogo="images/CF_240x240.png"),_.forEach(a.showingsData,function(b){c.get("http://api.moviesowl.com/v1/showings/"+b.id).then(function(c){for(var d=(c.data,c.data.seats),f=0,g=0,h=0;h<d.length;h++)for(var i=0;i<d[h].length;i++)"available"===d[h][i]&&f++,"taken"===d[h][i]&&(f++,g+=1);b.totalNumOfSeats=f,b.cinemaSize=l(f),b.fullness=m(f,g),b.seats=d,e.setShowingsData(a.showingsData)})})}function l(a){return console.log(a),150>a?"Small":200>a?"Medium":"Large"}function m(a,b){if(0===a&&0===b)return"not available";var c=parseInt(b/a*100);return c>80?"Full":c>30?"Almost Full":c+"% Full"}i(),a.openSeatView=function(b){var c=_.find(a.showingsData,function(a){return a.id===parseInt(b)});c.seats&&c.seats.length>0&&(console.log("am i here"),f.go("seats",{showId:b}))},h.fromTemplateUrl("templates/movieDetails.html",{scope:a,animation:"scale-in"}).then(function(b){a.modal=b}),a.openModal=function(){a.modal.show()},a.closeModal=function(){a.modal.hide()},a.$on("$destroy",function(){a.modal.remove()})}]),angular.module("moviesowlApp").controller("SeatsCtrl",["$scope","$http","$stateParams","showingsDataService","selectedMovieService","$timeout",function(a,b,c,d,e,f){function g(){var b=_.find(d.showingsData,function(a){return a.id===parseInt(c.showId)});a.session=b,f(function(){h(b)},1e3)}function h(b){a.seatingPlan=b.seats;var c=a.seatingPlan[0].length;a.seatWidth=100/c}function i(){console.log("Reloading Seats"),b.get("http://api.moviesowl.com/v1/showings/"+c.showId).then(function(b){a.seatingPlan=b.data.seats,a.$broadcast("scroll.refreshComplete")},function(){a.$broadcast("scroll.refreshComplete")})}a.doRefresh=i,a.movie=e.selectedMovie,g()}]),angular.module("moviesowlApp").factory("showingsDataService",function(){function a(a){b.showingsData=a}var b={setShowingsData:a,showingsData:[]};return b}),angular.module("moviesowlApp").factory("selectedMovieService",function(){function a(a){console.log("set movie",a),b.selectedMovie=a}var b={setMovie:a,selectedMovie:{}};return b}),angular.module("moviesowlApp").factory("cinemasList",function(){var a=[{id:1,location:"Australia Fair Cinemas"},{id:2,location:"Brisbane City Myer Centre"},{id:3,location:"Browns Plains"},{id:4,location:"Cairns Central"},{id:5,location:"Cairns City"},{id:6,location:"Cairns Earlville"},{id:7,location:"Capalaba"},{id:8,location:"Carindale"},{id:9,location:"Chermside"},{id:10,location:"Coolangatta"},{id:11,location:"Garden City Mt Gravatt"},{id:12,location:"Indooroopilly"},{id:13,location:"Ipswich"},{id:14,location:"Loganholme"},{id:15,location:"Mackay City"},{id:16,location:"Mackay Mount Pleasant"},{id:17,location:"Maroochydore Sunshine Plaza"},{id:18,location:"Moonlight Cinema Brisbane"},{id:19,location:"Morayfield"},{id:20,location:"Noosa Cinemas"},{id:21,location:"Robina"},{id:22,location:"Rockhampton North"},{id:23,location:"Strathpine"},{id:24,location:"Toombul"},{id:25,location:"Toowoomba Grand Central"},{id:26,location:"Toowoomba Strand"},{id:27,location:"Townsville Central"},{id:28,location:"Townsville City"},{id:29,location:"Moonlight Cinema Port Douglas"}],b={cinemas:a};return b});